<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Apache Pulsar 2.6.0 · Apache Pulsar</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="We are very glad to see the Apache Pulsar community has successfully released the wonderful 2.6.0 version after accumulated hard work. It is a great milestone for this fast-growing project and the whole Pulsar community. This is the result of a huge effort from the community, with over 450 commits and a long list of new features, improvements, and bug fixes."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Apache Pulsar 2.6.0 · Apache Pulsar"/><meta property="og:type" content="website"/><meta property="og:url" content="https://pulsar.apache.org/blog/2020/06/18/Apache-Pulsar-2-6-0"/><meta property="og:description" content="We are very glad to see the Apache Pulsar community has successfully released the wonderful 2.6.0 version after accumulated hard work. It is a great milestone for this fast-growing project and the whole Pulsar community. This is the result of a huge effort from the community, with over 450 commits and a long list of new features, improvements, and bug fixes."/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://pulsar.apache.org/img/pulsar.svg"/><link rel="shortcut icon" href="/img/pulsar.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://pulsar.apache.org/blog/atom.xml" title="Apache Pulsar Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://pulsar.apache.org/blog/feed.xml" title="Apache Pulsar Blog RSS Feed"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-102219959-1', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="/css/code-blocks-buttons.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/custom.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/en"><img class="logo" src="/img/pulsar.svg" alt="Apache Pulsar"/></a><a href="/en/versions"><h3>2.9.2</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/en/standalone" target="_self">Docs</a></li><li class=""><a href="/en/download" target="_self">Download</a></li><li class=""><a href="/docs/en/client-libraries" target="_self">Clients</a></li><li class=""><a href="#restapis" target="_self">REST APIs</a></li><li class=""><a href="#cli" target="_self">Cli</a></li><li class="siteNavGroupActive"><a href="/blog/" target="_self">Blog</a></li><li class=""><a href="#community" target="_self">Community</a></li><li class=""><a href="#apache" target="_self">Apache</a></li><li class=""><a href="https://pulsar-next.staged.apache.org/" target="_self">New Website(Beta)</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>English</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/ja">日本語</a></li><li><a href="/fr">Français</a></li><li><a href="/ko">한국어</a></li><li><a href="/zh-CN">中文</a></li><li><a href="/zh-TW">繁體中文</a></li><li><a href="https://crowdin.com/project/apache-pulsar" target="_blank" rel="noreferrer noopener">Help Translate</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Recent Posts</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Recent Posts</h3><ul class=""><li class="navListItem"><a class="navItem" href="/blog/2022/04/08/Apache-Pulsar-2-9-2">What’s New in Apache Pulsar 2.9.2</a></li><li class="navListItem"><a class="navItem" href="/blog/2021/12/14/Apache-Pulsar-2-7-4">What’s New in Apache Pulsar 2.7.4</a></li><li class="navListItem"><a class="navItem" href="/blog/2021/12/11/Log4j-CVE">Log4j2 Zero Day vulnerability (CVE-2021-44228)</a></li><li class="navListItem"><a class="navItem" href="/blog/2021/09/23/Apache-Pulsar-2-8-1">Apache Pulsar 2.8.1</a></li><li class="navListItem"><a class="navItem" href="/blog/2021/08/18/asia-cfp">Announcing Pulsar Summit Asia 2021: CFP Is Open!</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer postContainer blogContainer"><div class="wrapper"><div class="lonePost"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2020/06/18/Apache-Pulsar-2-6-0">Apache Pulsar 2.6.0</a></h1><p class="post-meta">June 18, 2020</p><div class="authorBlock"><p class="post-authorName"><a href="https://twitter.com/lipenghui6" target="_blank" rel="noreferrer noopener">Penghui Li</a></p></div></header><div><span><p>We are very glad to see the Apache Pulsar community has successfully released the wonderful 2.6.0 version after accumulated hard work. It is a great milestone for this fast-growing project and the whole Pulsar community. This is the result of a huge effort from the community, with over 450 commits and a long list of new features, improvements, and bug fixes.</p>
<p>Here is a selection of some of the most interesting and major features added to Pulsar 2.6.0.</p>
<!--truncate-->
<h2><a class="anchor" aria-hidden="true" id="core-pulsar"></a><a href="#core-pulsar" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Core Pulsar</h2>
<h3><a class="anchor" aria-hidden="true" id="pip-37-large-message-size-support"></a><a href="#pip-37-large-message-size-support" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>[PIP-37] Large message size support</h3>
<p>This PIP adds support for producing and consuming large size messages by splitting the large message into multiple chunks. This is a very powerful feature for sending and consuming very large messages.</p>
<p>Currently, this feature only works for the non-shared subscription and it has client-side changes. You need to upgrade the Pulsar client version to 2.6.0. You can enable the message trunk at the producer side as below.</p>
<pre><code class="hljs css language-java">client.newProducer()
    .topic(<span class="hljs-string">"my-topic"</span>)
    .enableChunking(<span class="hljs-keyword">true</span>)
    .create();
</code></pre>
<p>For more information about PIP-37, see <a href="https://github.com/apache/pulsar/wiki/PIP-37:-Large-message-size-handling-in-Pulsar">here</a>. <br> For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/4400">PR-4440</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="pip-39-namespace-change-events-system-topic"></a><a href="#pip-39-namespace-change-events-system-topic" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>[PIP-39] Namespace change events (system topic)</h3>
<p>This PIP introduces the system topic to store namespace change events. Previously, Pulsar only allowed you to set the namespace policy, all topics under the namespace followed the namespace policy. Many users want to set the policy for topics. The main reason for not using the same way as namespace level policy is to avoid introducing more workload on the ZooKeeper.</p>
<p>The original intention of the system topic is to be able to store topic policy in a topic rather than ZooKeeper. So this is the first step to achieve topic level policy. And we can easily add support for the topic level policy with this feature.</p>
<p>For more information about PIP-39, see <a href="https://github.com/apache/pulsar/wiki/PIP-39%3A-Namespace-Change-Events">here</a>.<br> For more information about implementation details, see  <a href="https://github.com/apache/pulsar/pull/4955">PR-4955</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="pip-45-pluggable-metadata-interface"></a><a href="#pip-45-pluggable-metadata-interface" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>[PIP-45] Pluggable metadata interface</h3>
<p>We have been advancing to enable Pulsar to use other metastore services rather than ZooKeeper. This PIP converts <code>ManagedLedger</code> to use the <code>MetadataStore</code> interface. This facilitates the metadata server plug-in process. Through the <code>MetadataStore</code> interface, it is easy to add other metadata servers into Pulsar such as <a href="https://github.com/etcd-io/etcd">etcd</a>.</p>
<p>For more information about PIP-45, see <a href="https://github.com/apache/pulsar/wiki/PIP-45%3A-Pluggable-metadata-interface">here</a>. <br> For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/5358">PR-5358</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="pip-54-support-acknowledgment-at-the-batch-index-level"></a><a href="#pip-54-support-acknowledgment-at-the-batch-index-level" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>[PIP-54] Support acknowledgment at the batch index level</h3>
<p>Previously, the broker only tracked the acknowledged state in the batch message level. If a subset of the batch messages was acknowledged, the consumer could still get the acknowledged message of that batch message while the batch message redelivery happened.</p>
<p>This PIP adds support for acknowledging the local batch index of a batch. This feature is not enabled by default. You can enable it in the <code>broker.conf</code> as below.</p>
<pre><code class="hljs"><span class="hljs-attr">acknowledgmentAtBatchIndexLevelEnabled</span>=<span class="hljs-literal">true</span>
</code></pre>
<p>For more information about PIP-54, see <a href="https://github.com/apache/pulsar/wiki/PIP-54:-Support-acknowledgment-at-batch-index-level">here</a>. <br> For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/6052">PR-6052</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="pip-58-support-consumers-setting-custom-message-retry-delay"></a><a href="#pip-58-support-consumers-setting-custom-message-retry-delay" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>[PIP-58] Support consumers setting custom message retry delay</h3>
<p>For many online business systems, various exceptions usually occur in business logic processing, so the message needs to be re-consumed, but users hope that this delay time can be controlled flexibly. Previously, processing methods were usually to send messages to special retry topics, because production can specify any delay, so consumers subscribe to the business topic and retry topic at the same time. Now you can set a retry delay for each message as below.</p>
<pre><code class="hljs css language-java">Consumer&lt;<span class="hljs-keyword">byte</span>[]&gt; consumer = pulsarClient.newConsumer(Schema.BYTES)
    .enableRetry(<span class="hljs-keyword">true</span>)
    .receiverQueueSize(<span class="hljs-number">100</span>)
    .deadLetterPolicy(DeadLetterPolicy.builder()
        .maxRedeliverCount(maxRedeliveryCount)
        .retryLetterTopic(<span class="hljs-string">"persistent://my-property/my-ns/my-subscription-custom-Retry"</span>)
        .build())
    .subscribe();

consumer.reconsumeLater(message, <span class="hljs-number">10</span>, TimeUnit.SECONDS);
</code></pre>
<p>For more information about PIP-58, see <a href="https://github.com/apache/pulsar/wiki/PIP-58-%3A-Support-Consumers--Set-Custom-Retry-Delay">here</a>. <br> For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/6449">PR-6449</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="pip-60-support-sni-routing-to-support-various-proxy-servers"></a><a href="#pip-60-support-sni-routing-to-support-various-proxy-servers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>[PIP-60] Support SNI routing to support various proxy servers</h3>
<p>Previously, Pulsar did not provide support to use other proxies, such as Apache Traffic Server (ATS), HAProxy, Nginx, and Envoy, which are more scalable and secured. Most of these proxy servers support SNI routing which can route traffic to a destination without having to terminate the SSL connection. This PIP adds SNI routing and makes changes to the Pulsar client.</p>
<p>For more information about PIP-60, see <a href="https://github.com/apache/pulsar/wiki/PIP-60:-Support-Proxy-server-with-SNI-routing">here</a>. <br> For more information about implementation details, see  <a href="https://github.com/apache/pulsar/pull/6566">PR-6566</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="pip-61-advertise-multiple-addresses"></a><a href="#pip-61-advertise-multiple-addresses" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>[PIP-61] Advertise multiple addresses</h3>
<p>This PIP allows the broker to expose multiple advertised listeners and to support the separation of internal and external network traffic. You can specify multiple advertised listeners in <code>broker.conf</code> as below.</p>
<pre><code class="hljs">advertisedListeners=<span class="hljs-string">internal:</span><span class="hljs-string">pulsar:</span><span class="hljs-comment">//192.168.1.11:6660,external:pulsar://110.95.234.50:6650</span>
</code></pre>
<p>From the client side, you can specify the listener name for the client as below.</p>
<pre><code class="hljs css language-java">PulsarClient.builder()
    .serviceUrl(url)
    .listenerName(<span class="hljs-string">"internal"</span>)
    .build();
</code></pre>
<p>For more information about PIP-61, see <a href="https://github.com/apache/pulsar/wiki/PIP-61%3A-Advertised-multiple-addresses">here</a>. <br> For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/6903">PR-6903</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="pip-65-adapt-pulsar-io-sources-to-support-batchsources"></a><a href="#pip-65-adapt-pulsar-io-sources-to-support-batchsources" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>[PIP-65] Adapt Pulsar IO sources to support <code>BatchSources</code></h3>
<p>This PIP introduces <code>BatchSource</code> as a new interface for writing batch-based connectors. It also introduces <code>BatchSourceTriggerer</code> as an interface to trigger the data collection of a <code>BatchSource</code>. It then provides system implementation in <code>BatchSourceExecutor</code>.</p>
<p>For more information about PIP-65, see <a href="https://github.com/apache/pulsar/wiki/PIP-65%3A-Adapting-Pulsar-IO-Sources-to-support-Batch-Sources">here</a>. <br> For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/7090">PR-7090</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="load-balancer-add-thresholdshedder-strategy-for-the-load-balancer"></a><a href="#load-balancer-add-thresholdshedder-strategy-for-the-load-balancer" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>[Load balancer] Add <code>ThresholdShedder</code> strategy for the load balancer</h3>
<p>The <code>ThresholdShedder</code> strategy is more flexible than <code>LoadSheddingStrategy</code> for Pulsar. The <code>ThresholdShedder</code> calculates the average resource usage of the brokers, and individual broker resource usage compares with the average value. If it is greater than the average value plus threshold, the overload shedder is triggered. You can enable it in <code>broker.conf</code> as below.</p>
<pre><code class="hljs">loadBalancerLoadSheddingStrategy=org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.pulsar</span><span class="hljs-selector-class">.broker</span><span class="hljs-selector-class">.loadbalance</span><span class="hljs-selector-class">.impl</span><span class="hljs-selector-class">.ThresholdShedder</span>
</code></pre>
<p>You can customize more parameters for the <code>ThresholdShedder</code> if needed as below.</p>
<pre><code class="hljs"><span class="hljs-comment"># The broker resource usage threshold.</span>
<span class="hljs-comment"># When the broker resource usage is greater than the pulsar cluster average resource usage,</span>
<span class="hljs-comment"># the threshold shedder will be triggered to offload bundles from the broker.</span>
<span class="hljs-comment"># It only takes effect in ThresholdShedder strategy.</span>
<span class="hljs-attr">loadBalancerBrokerThresholdShedderPercentage</span>=<span class="hljs-number">10</span>

<span class="hljs-comment"># When calculating new resource usage, the history usage accounts for.</span>
<span class="hljs-comment"># It only takes effect in ThresholdShedder strategy.</span>
<span class="hljs-attr">loadBalancerHistoryResourcePercentage</span>=<span class="hljs-number">0.9</span>

<span class="hljs-comment"># The BandWithIn usage weight when calculating new resource usage.</span>
<span class="hljs-comment"># It only takes effect in ThresholdShedder strategy.</span>
<span class="hljs-attr">loadBalancerBandwithInResourceWeight</span>=<span class="hljs-number">1.0</span>

<span class="hljs-comment"># The BandWithOut usage weight when calculating new resource usage.</span>
<span class="hljs-comment"># It only takes effect in ThresholdShedder strategy.</span>
<span class="hljs-attr">loadBalancerBandwithOutResourceWeight</span>=<span class="hljs-number">1.0</span>

<span class="hljs-comment"># The CPU usage weight when calculating new resource usage.</span>
<span class="hljs-comment"># It only takes effect in ThresholdShedder strategy.</span>
<span class="hljs-attr">loadBalancerCPUResourceWeight</span>=<span class="hljs-number">1.0</span>

<span class="hljs-comment"># The heap memory usage weight when calculating new resource usage.</span>
<span class="hljs-comment"># It only takes effect in ThresholdShedder strategy.</span>
<span class="hljs-attr">loadBalancerMemoryResourceWeight</span>=<span class="hljs-number">1.0</span>

<span class="hljs-comment"># The direct memory usage weight when calculating new resource usage.</span>
<span class="hljs-comment"># It only takes effect in ThresholdShedder strategy.</span>
<span class="hljs-attr">loadBalancerDirectMemoryResourceWeight</span>=<span class="hljs-number">1.0</span>

<span class="hljs-comment"># Bundle unload minimum throughput threshold (MB), avoiding bundle unload frequently.</span>
<span class="hljs-comment"># It only takes effect in ThresholdShedder strategy.</span>
<span class="hljs-attr">loadBalancerBundleUnloadMinThroughputThreshold</span>=<span class="hljs-number">10</span>
</code></pre>
<p>For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/6772">PR-6772</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="key-shared-add-consistent-hashing-in-the-key_shared-distribution"></a><a href="#key-shared-add-consistent-hashing-in-the-key_shared-distribution" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>[Key Shared] Add consistent hashing in the Key_Shared distribution</h3>
<p>Previously, the implementation of the Key_Shared subscription used a mechanism to divide their hash space across the available consumers. This was based on dividing the currently assigned hash ranges when a new consumer joined or left. Pulsar 2.6.0 introduces a new consistent hash distribution for the Key_Shared subscription. You can enable the consistent hash distribution in <code>broker.conf</code> and the auto split approach is still selected by default.</p>
<pre><code class="hljs"># <span class="hljs-keyword">On</span> KeyShared subscriptions, <span class="hljs-keyword">with</span> <span class="hljs-keyword">default</span> AUTO_SPLIT mode, use splitting ranges <span class="hljs-keyword">or</span>
# consistent hashing <span class="hljs-keyword">to</span> <span class="hljs-keyword">reassign</span> keys <span class="hljs-keyword">to</span> <span class="hljs-built_in">new</span> consumers
subscriptionKeySharedUseConsistentHashing=<span class="hljs-keyword">false</span>

# <span class="hljs-keyword">On</span> KeyShared subscriptions, number <span class="hljs-keyword">of</span> points <span class="hljs-keyword">in</span> the consistent-hashing ring.
# The higher the number, the more equal the assignment <span class="hljs-keyword">of</span> keys <span class="hljs-keyword">to</span> consumers
subscriptionKeySharedConsistentHashingReplicaPoints=<span class="hljs-number">100</span>
</code></pre>
<p>We plan to use consistent hash distribution by default in the subsequent versions.
For more information about implementation details, see  <a href="https://github.com/apache/pulsar/pull/6791">PR-6791</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="key-shared-fix-ordering-issue-in-keyshared-dispatcher-when-adding-consumers"></a><a href="#key-shared-fix-ordering-issue-in-keyshared-dispatcher-when-adding-consumers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>[Key Shared] Fix ordering issue in KeyShared dispatcher when adding consumers</h3>
<p>This is a great fix for the Key_Shared subscription. Previously, ordering was broken in a KeyShared dispatcher if a new consumer c2 came in and an existing consumer c1 went out. This was because messages with keys previously assigned to c1 may route to c2, which might break the message ordering dispatch guarantee in the Key_Shared subscription. This PR introduces new consumers joining in a &quot;paused&quot; state until the previous messages are acknowledged to ensure the messages are dispatched orderly.</p>
<p>If you still want the relaxed ordering, you can set up at the consumer side as below.</p>
<pre><code class="hljs css language-java">pulsarClient.newConsumer()
    .keySharedPolicy(KeySharedPolicy.autoSplitHashRange().setAllowOutOfOrderDelivery(<span class="hljs-keyword">true</span>))
    .subscribe();
</code></pre>
<p>For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/7106">PR-7106</a> and <a href="https://github.com/apache/pulsar/pull/7108">PR-7108</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="key-shared-add-support-for-key-hash-range-reading"></a><a href="#key-shared-add-support-for-key-hash-range-reading" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>[Key Shared] Add support for key hash range reading</h3>
<p>This PR supports sticky key hash range reader. A broker only dispatches messages whose hash of the message key contains by a specified key hash range. Besides, multiple key hash ranges can be specified on a reader.</p>
<pre><code class="hljs css language-java">pulsarClient.newReader()
    .topic(topic)
    .startMessageId(MessageId.earliest)
    .keyHashRange(Range.of(<span class="hljs-number">0</span>, <span class="hljs-number">10000</span>), Range.of(<span class="hljs-number">20001</span>, <span class="hljs-number">30000</span>))
    .create();
</code></pre>
<p>For more information about implementation details, see  <a href="https://github.com/apache/pulsar/pull/5928">PR-5928</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="use-pure-java-air-compressor-instead-of-jni-based-libraries"></a><a href="#use-pure-java-air-compressor-instead-of-jni-based-libraries" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Use pure-java Air-Compressor instead of JNI based libraries</h3>
<p>Previously, JNI based libraries were used to perform data compression. While these libraries do have an overhead in terms of size and affect the JNI overhead which is typically measurable when compressing many small payloads. This PR replaces compression libraries for LZ4, ZStd, and Snappy with <a href="https://github.com/airlift/aircompressor">AirCompressor</a>, which is a pure Java compression library used by Presto.</p>
<p>For more information about implementation details, see  <a href="https://github.com/apache/pulsar/pull/5390">PR-5390</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="support-multiple-pulsar-clusters-using-the-same-bookkeeper-cluster"></a><a href="#support-multiple-pulsar-clusters-using-the-same-bookkeeper-cluster" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Support multiple Pulsar clusters using the same BookKeeper cluster</h3>
<p>This PR allows multiple pulsar clusters to use the specified BookKeeper cluster by pointing BookKeeper client to the ZooKeeper connection string of BookKeeper cluster. This PR adds a configuration (<code>bookkeeperMetadataServiceUri</code>) to discover BookKeeper cluster metadata store and uses metadata service URI to initialize BookKeeper clients.</p>
<pre><code class="hljs"><span class="hljs-meta"># Metadata service uri that bookkeeper is used for loading corresponding metadata driver</span>
<span class="hljs-meta"># and resolving its metadata service location.</span>
<span class="hljs-meta"># This value can be fetched using `bookkeeper shell whatisinstanceid` command in BookKeeper cluster.</span>
<span class="hljs-meta"># For example: zk+hierarchical://localhost:2181/ledgers</span>
<span class="hljs-meta"># The metadata service uri list can also be semicolon separated values like below:</span>
<span class="hljs-meta"># zk+hierarchical://zk1:2181;zk2:2181;zk3:2181/ledgers</span>
bookkeeperMetadataServiceUri=
</code></pre>
<p>For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/5985">PR-5985</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="support-deleting-inactive-topics-when-subscriptions-are-caught-up"></a><a href="#support-deleting-inactive-topics-when-subscriptions-are-caught-up" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Support deleting inactive topics when subscriptions are caught up</h3>
<p>Previously, Pulsar supported deleting inactive topics which do not have active producers and subscriptions. This PR supports deleting inactive topics when all subscriptions of the topic are caught up and when there are no active producers or consumers. This PR exposes inactive topic delete mode in <code>broker.conf</code>. In the future, we can support a namespace level configuration for the inactive topic delete mode.</p>
<pre><code class="hljs"># Set the inactive topic <span class="hljs-keyword">delete</span> <span class="hljs-keyword">mode</span>. Default <span class="hljs-keyword">is</span> delete_when_no_subscriptions
# <span class="hljs-string">'delete_when_no_subscriptions'</span> <span class="hljs-keyword">mode</span> <span class="hljs-keyword">only</span> <span class="hljs-keyword">delete</span> the topic which <span class="hljs-built_in">has</span> <span class="hljs-keyword">no</span> subscriptions <span class="hljs-built_in">and</span> <span class="hljs-keyword">no</span> active producers
# <span class="hljs-string">'delete_when_subscriptions_caught_up'</span> <span class="hljs-keyword">mode</span> <span class="hljs-keyword">only</span> <span class="hljs-keyword">delete</span> the topic that <span class="hljs-keyword">all</span> subscriptions <span class="hljs-built_in">has</span> <span class="hljs-keyword">no</span> backlogs(caught <span class="hljs-keyword">up</span>)
# <span class="hljs-built_in">and</span> <span class="hljs-keyword">no</span> active producers/consumers
brokerDeleteInactiveTopicsMode=delete_when_no_subscriptions
</code></pre>
<p>For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/6077">PR-6077</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="add-a-flag-to-skip-broker-shutdown-on-transient-oom"></a><a href="#add-a-flag-to-skip-broker-shutdown-on-transient-oom" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Add a flag to skip broker shutdown on transient OOM</h3>
<p>A high dispatch rate on one of the topics may cause a broker to go OOM temporarily. It is a transient error and the broker can recover within a few seconds as soon as some memory gets released. However, in 2.4 release (<a href="https://github.com/apache/pulsar/pull/4196">#4196</a>), the “restarted broker on OOM” feature can cause huge instability in a cluster, where a topic moves from one broker to another and restarts multiple brokers and disrupts other topics as well. So this PR provides a dynamic flag to skip broker shutdown on OOM to avoid instability in a cluster.</p>
<p>For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/6634">PR-6634</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="make-zookeeper-cache-expiry-time-configurable"></a><a href="#make-zookeeper-cache-expiry-time-configurable" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Make ZooKeeper cache expiry time configurable</h3>
<p>Previously, ZooKeeper cache expiry time was hardcoded and it needed to be configurable to refresh the value based on various requirements, for example, refreshing the value quickly in case of zk-watch miss, avoiding frequent cache refresh to avoid zk-read or avoiding issue due to zk read timeout, and so on. Now you can configure ZooKeeper cache expiry time in <code>broker.conf</code> as below.</p>
<pre><code class="hljs"><span class="hljs-comment"># ZooKeeper cache expiry time in seconds</span>
<span class="hljs-attr">zooKeeperCacheExpirySeconds</span>=<span class="hljs-number">300</span>
</code></pre>
<p>For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/6668">PR-6668</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="optimize-consumer-fetch-messages-in-case-of-batch-message"></a><a href="#optimize-consumer-fetch-messages-in-case-of-batch-message" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Optimize consumer fetch messages in case of batch message</h3>
<p>When a consumer sends a fetch request to a broker server, it contains a fetch message number telling the server how many messages should be pushed to a consumer client. However, the broker server stores data in BookKeeper or broker cache according to entry rather than a single message if the producer produces messages using the batch feature. There is a gap to map the number of messages to the number of entries when dealing with consumer fetch requests. This PR adds a variable <code>avgMessagesPerEntry</code> to record average messages stored in one entry. It updates when a broker server pushes messages to a consumer. When dealing with consumer fetch requests, it maps fetch request number to entry number. Additionally, this PR exposes the <code>avgMessagePerEntry</code> static value to consumer stat metric json.</p>
<p>You can enable <code>preciseDispatcherFlowControl</code> in <code>broker.conf</code> as below.</p>
<pre><code class="hljs"><span class="hljs-comment"># Precise dispatcher flow control according to history message number of each entry</span>
<span class="hljs-attr">preciseDispatcherFlowControl</span>=<span class="hljs-literal">false</span>
</code></pre>
<p>For more information about implementation details, see  <a href="https://github.com/apache/pulsar/pull/6719">PR-6719</a></p>
<h3><a class="anchor" aria-hidden="true" id="introduce-precise-topic-publish-rate-limiting"></a><a href="#introduce-precise-topic-publish-rate-limiting" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introduce precise topic publish rate limiting</h3>
<p>Previously, Pulsar supported the publish rate limiting but it is not a precise control. Now, for some use cases that need precise control, you can enable it in <code>broker.conf</code> as below.</p>
<pre><code class="hljs"><span class="hljs-attr">preciseTopicPublishRateLimiterEnable</span>=<span class="hljs-literal">true</span>
</code></pre>
<p>For more information about implementation details, see  <a href="https://github.com/apache/pulsar/pull/7078">PR-7078</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="expose-check-delay-of-new-entries-in-brokerconf"></a><a href="#expose-check-delay-of-new-entries-in-brokerconf" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Expose check delay of new entries in <code>broker.conf</code></h3>
<p>Previously, the check delay of new entries was 10 ms and could not be changed by users. Currently, for consumption latency sensitive scenarios, you can set the value of check delay of new entries to a smaller value or 0 in <code>broker.conf</code> as below. Using a smaller value may degrade consumption throughput.</p>
<pre><code class="hljs"><span class="hljs-attr">managedLedgerNewEntriesCheckDelayInMillis</span>=<span class="hljs-number">10</span>
</code></pre>
<p>For more information about implementation details, see  <a href="https://github.com/apache/pulsar/pull/7154">PR-7154</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="schema--supports-null-key-and-null-value-in-keyvalue-schema"></a><a href="#schema--supports-null-key-and-null-value-in-keyvalue-schema" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>[Schema]  Supports <code>null</code> key and <code>null</code> value in KeyValue schema</h3>
<p>For more information about implementation details, see  <a href="https://github.com/apache/pulsar/pull/7139">PR-7139</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="support-triggering-ledger-rollover-when-maxledgerrollovertimeminutes-is-met"></a><a href="#support-triggering-ledger-rollover-when-maxledgerrollovertimeminutes-is-met" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Support triggering ledger rollover when <code>maxLedgerRolloverTimeMinutes</code> is met</h3>
<p>This PR implements a monitoring thread to check if the current topic ledger meets the constraint of <code>managedLedgerMaxLedgerRolloverTimeMinutes</code> and triggers a rollover to make the configuration take effect. Another important idea is that if you trigger a rollover, you can close the current ledger so that you can release the storage of the current ledger. For some less commonly used topics, the current ledger data is likely to be expired and the current rollover logic is only triggered when adding a new entry. Obviously, this results in a waste of disk space. The monitoring thread is scheduled at a fixed time interval and the interval is set to <code>managedLedgerMaxLedgerRolloverTimeMinutes</code>. Each inspection makes two judgments at the same time, for example, <code>currentLedgerEntries &gt; 0</code> and <code>currentLedgerIsFull()</code>. When the number of current entries is equal to 0, it does not trigger a new rollover and you can use this to reduce the ledger creation.</p>
<p>For more information about implementation details, see  <a href="https://github.com/apache/pulsar/pull/7111">PR-7116</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="proxy"></a><a href="#proxy" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Proxy</h2>
<h3><a class="anchor" aria-hidden="true" id="add-rest-api-to-get-connection-and-topic-stats"></a><a href="#add-rest-api-to-get-connection-and-topic-stats" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Add REST API to get connection and topic stats</h3>
<p>Previously, Pulsar proxy did not have useful stats to get internal information about the proxy. It is better to have internal-stats of proxy to get information, such as live connections, topic stats (with higher logging level), and so on. This PR adds REST API to get stats for connection and topics served by proxy.</p>
<p>For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/6473">PR-6473</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="admin"></a><a href="#admin" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Admin</h2>
<h3><a class="anchor" aria-hidden="true" id="support-getting-a-message-by-message-id-in-pulsar-admin"></a><a href="#support-getting-a-message-by-message-id-in-pulsar-admin" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Support getting a message by message ID in pulsar-admin</h3>
<p>This PR adds a new command <code>get-message-by-id</code> to the pulsar-admin. It allows users to check a single message by providing ledger ID and entry ID.</p>
<p>For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/6331">PR-6331</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="support-deleting-subscriptions-forcefully"></a><a href="#support-deleting-subscriptions-forcefully" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Support deleting subscriptions forcefully</h3>
<p>This PR adds the method <code>deleteForcefully</code> to support force deleting subscriptions.</p>
<p>For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/6383">PR-6383</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="functions"></a><a href="#functions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Functions</h2>
<h3><a class="anchor" aria-hidden="true" id="built-in-functions"></a><a href="#built-in-functions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Built-in functions</h3>
<p>This PR implements the possibility of creating built-in functions in the same way as adding built-in connectors.</p>
<p>For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/6895">PR-6895</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="add-go-function-heartbeat-and-grpc-service-for-production-usage"></a><a href="#add-go-function-heartbeat-and-grpc-service-for-production-usage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Add Go Function heartbeat (and gRPC service) for production usage</h3>
<p>For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/6031">PR-6031</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="add-custom-property-options-to-functions"></a><a href="#add-custom-property-options-to-functions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Add custom property options to functions</h3>
<p>This PR allows users to set custom system properties while submitting functions. This can be used to pass credentials via a system property.</p>
<p>For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/6348">PR-6348</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="separate-tls-configurations-of-function-worker-and-broker"></a><a href="#separate-tls-configurations-of-function-worker-and-broker" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Separate TLS configurations of function worker and broker</h3>
<p>For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/6602">PR-6602</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="add-the-ability-to-build-consumers-in-functions-and-sources"></a><a href="#add-the-ability-to-build-consumers-in-functions-and-sources" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Add the ability to build consumers in functions and sources</h3>
<p>Previously, function and source context give their writers an ability to create publishers but not consumers. This PR fixes this issue.</p>
<p>For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/6954">PR-6954</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="pulsar-sql"></a><a href="#pulsar-sql" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pulsar SQL</h2>
<h3><a class="anchor" aria-hidden="true" id="support-keyvalue-schema"></a><a href="#support-keyvalue-schema" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Support KeyValue schema</h3>
<p>Previously, Pulsar SQL could not read the KeyValue schema data.</p>
<p>This PR adds KeyValue schema support for Pulsar SQL. It adds the prefix <code>key.</code> for the key field name and <code>value.</code> for the value field name.</p>
<p>For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/6325">PR-6325</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="support-multiple-avro-schema-versions"></a><a href="#support-multiple-avro-schema-versions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Support multiple Avro schema versions</h3>
<p>Previously, if you have multiple Avro schema versions for a topic, using the Pulsar SQL to query data from this topic will introduce some problems. With this change, You can evolve the schema of the topic and keep transitive backward compatibility of all schemas of the topic if you want to query data from this topic.</p>
<p>For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/4847">PR-4847</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="java-client"></a><a href="#java-client" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Java client</h2>
<h3><a class="anchor" aria-hidden="true" id="support-waiting-for-inflight-messages-while-closing-a-producer"></a><a href="#support-waiting-for-inflight-messages-while-closing-a-producer" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Support waiting for inflight messages while closing a producer</h3>
<p>Previously, when you closed a producer, the pulsar-client immediately failed inflight messages even if it persisted successfully at the broker. Most of the time, users want to wait for those inflight messages rather than fail them. While the pulsar-client library did not provide a way to wait for inflight messages before closing the producer. This PR supports closing API with a flag where you can control waiting for inflight messages. With this change, you can close a producer by waiting for inflight messages and the pulsar-client does not fail those messages immediately.
Previously, when you closed a producer, the pulsar-client immediately failed inflight messages even if it persisted successfully at the broker. Most of the time, users want to wait for those inflight messages rather than fail them. While the pulsar-client library did not provide a way to wait for inflight messages before closing the producer. This PR supports closing API with a flag where you can control waiting for inflight messages. With this change, you can close a producer by waiting for inflight messages and the pulsar-client does not fail those messages immediately.</p>
<p>For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/6648">PR-6648</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="support-loading-tls-certskey-dynamically-from-input-stream"></a><a href="#support-loading-tls-certskey-dynamically-from-input-stream" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Support loading TLS certs/key dynamically from input stream</h3>
<p>Previously, the pulsar-client provided TLS authentication support and the default TLS provider <code>AuthenticationTls</code> expected file path of cert and key files. However, there were use cases where it was difficult for user applications to store certs/key files locally for TLS authentication. This PR adds stream support in <code>AuthenticationTls</code> to provide X509Certs and PrivateKey which also perform auto-refresh when streaming changes in a given provider.</p>
<p>For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/6760">PR-6760</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="support-returning-sequence-id-when-throwing-an-exception-for-async-send-messages"></a><a href="#support-returning-sequence-id-when-throwing-an-exception-for-async-send-messages" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Support returning sequence ID when throwing an exception for async send messages</h3>
<p>Previously, when sending messages asynchronously failed, an exception was thrown, but did not know which message was abnormal, and users did not know which messages needed to be retried. This PR makes changes supported on the client side. When throwing an exception, the sequenceId <code>org.apache.pulsar.client.api.PulsarClientException</code> is set.</p>
<p>For more information about implementation details, see <a href="https://github.com/apache/pulsar/pull/6825">PR-6825</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="more-information"></a><a href="#more-information" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>More information</h2>
<ul>
<li>To download Apache Pulsar 2.6.0, click <a href="https://pulsar.apache.org/en/download/">here</a>.</li>
<li>For more information about Apache Pulsar 2.6.0, see <a href="https://pulsar.apache.org/release-notes/#2.6.0">2.6.0 release notes</a> and <a href="https://github.com/apache/pulsar/pulls?q=milestone%3A2.6.0+-label%3Arelease%2F2.5.2+-label%3Arelease%2F2.5.1+">2.6.0 PR list</a>.</li>
</ul>
<p>If you have any questions or suggestions, contact us with mailing lists or slack.</p>
<ul>
<li><a href="mailto:users@pulsar.apache.org">users@pulsar.apache.org</a></li>
<li><a href="mailto:dev@pulsar.apache.org">dev@pulsar.apache.org</a></li>
<li>Pulsar slack channel: <a href="https://apache-pulsar.slack.com/">https://apache-pulsar.slack.com/</a></li>
<li>Self-registration at <a href="https://apache-pulsar.herokuapp.com/">https://apache-pulsar.herokuapp.com/</a></li>
</ul>
<p>Looking forward to your contributions to <a href="https://github.com/apache/pulsar">Pulsar</a>.</p>
</span></div></div><div class="blogSocialSection"><div class="blogSocialSectionItem"><a href="https://twitter.com/share" class="twitter-share-button" data-text="Apache Pulsar 2.6.0" data-url="https://pulsar.apache.org/blog/2020/06/18/Apache-Pulsar-2-6-0" data-related="true" data-show-count="false">Tweet</a></div></div></div><div class="blog-recent"><a class="button" href="/blog/">Recent Posts</a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#core-pulsar">Core Pulsar</a><ul class="toc-headings"><li><a href="#pip-37-large-message-size-support">[PIP-37] Large message size support</a></li><li><a href="#pip-39-namespace-change-events-system-topic">[PIP-39] Namespace change events (system topic)</a></li><li><a href="#pip-45-pluggable-metadata-interface">[PIP-45] Pluggable metadata interface</a></li><li><a href="#pip-54-support-acknowledgment-at-the-batch-index-level">[PIP-54] Support acknowledgment at the batch index level</a></li><li><a href="#pip-58-support-consumers-setting-custom-message-retry-delay">[PIP-58] Support consumers setting custom message retry delay</a></li><li><a href="#pip-60-support-sni-routing-to-support-various-proxy-servers">[PIP-60] Support SNI routing to support various proxy servers</a></li><li><a href="#pip-61-advertise-multiple-addresses">[PIP-61] Advertise multiple addresses</a></li><li><a href="#pip-65-adapt-pulsar-io-sources-to-support-batchsources">[PIP-65] Adapt Pulsar IO sources to support <code>BatchSources</code></a></li><li><a href="#load-balancer-add-thresholdshedder-strategy-for-the-load-balancer">[Load balancer] Add <code>ThresholdShedder</code> strategy for the load balancer</a></li><li><a href="#key-shared-add-consistent-hashing-in-the-key_shared-distribution">[Key Shared] Add consistent hashing in the Key_Shared distribution</a></li><li><a href="#key-shared-fix-ordering-issue-in-keyshared-dispatcher-when-adding-consumers">[Key Shared] Fix ordering issue in KeyShared dispatcher when adding consumers</a></li><li><a href="#key-shared-add-support-for-key-hash-range-reading">[Key Shared] Add support for key hash range reading</a></li><li><a href="#use-pure-java-air-compressor-instead-of-jni-based-libraries">Use pure-java Air-Compressor instead of JNI based libraries</a></li><li><a href="#support-multiple-pulsar-clusters-using-the-same-bookkeeper-cluster">Support multiple Pulsar clusters using the same BookKeeper cluster</a></li><li><a href="#support-deleting-inactive-topics-when-subscriptions-are-caught-up">Support deleting inactive topics when subscriptions are caught up</a></li><li><a href="#add-a-flag-to-skip-broker-shutdown-on-transient-oom">Add a flag to skip broker shutdown on transient OOM</a></li><li><a href="#make-zookeeper-cache-expiry-time-configurable">Make ZooKeeper cache expiry time configurable</a></li><li><a href="#optimize-consumer-fetch-messages-in-case-of-batch-message">Optimize consumer fetch messages in case of batch message</a></li><li><a href="#introduce-precise-topic-publish-rate-limiting">Introduce precise topic publish rate limiting</a></li><li><a href="#expose-check-delay-of-new-entries-in-brokerconf">Expose check delay of new entries in <code>broker.conf</code></a></li><li><a href="#schema--supports-null-key-and-null-value-in-keyvalue-schema">[Schema]  Supports <code>null</code> key and <code>null</code> value in KeyValue schema</a></li><li><a href="#support-triggering-ledger-rollover-when-maxledgerrollovertimeminutes-is-met">Support triggering ledger rollover when <code>maxLedgerRolloverTimeMinutes</code> is met</a></li></ul></li><li><a href="#proxy">Proxy</a><ul class="toc-headings"><li><a href="#add-rest-api-to-get-connection-and-topic-stats">Add REST API to get connection and topic stats</a></li></ul></li><li><a href="#admin">Admin</a><ul class="toc-headings"><li><a href="#support-getting-a-message-by-message-id-in-pulsar-admin">Support getting a message by message ID in pulsar-admin</a></li><li><a href="#support-deleting-subscriptions-forcefully">Support deleting subscriptions forcefully</a></li></ul></li><li><a href="#functions">Functions</a><ul class="toc-headings"><li><a href="#built-in-functions">Built-in functions</a></li><li><a href="#add-go-function-heartbeat-and-grpc-service-for-production-usage">Add Go Function heartbeat (and gRPC service) for production usage</a></li><li><a href="#add-custom-property-options-to-functions">Add custom property options to functions</a></li><li><a href="#separate-tls-configurations-of-function-worker-and-broker">Separate TLS configurations of function worker and broker</a></li><li><a href="#add-the-ability-to-build-consumers-in-functions-and-sources">Add the ability to build consumers in functions and sources</a></li></ul></li><li><a href="#pulsar-sql">Pulsar SQL</a><ul class="toc-headings"><li><a href="#support-keyvalue-schema">Support KeyValue schema</a></li><li><a href="#support-multiple-avro-schema-versions">Support multiple Avro schema versions</a></li></ul></li><li><a href="#java-client">Java client</a><ul class="toc-headings"><li><a href="#support-waiting-for-inflight-messages-while-closing-a-producer">Support waiting for inflight messages while closing a producer</a></li><li><a href="#support-loading-tls-certskey-dynamically-from-input-stream">Support loading TLS certs/key dynamically from input stream</a></li><li><a href="#support-returning-sequence-id-when-throwing-an-exception-for-async-send-messages">Support returning sequence ID when throwing an exception for async send messages</a></li></ul></li><li><a href="#more-information">More information</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2022 The Apache Software Foundation. All Rights Reserved. Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</section><span><script>
      const community = document.querySelector("a[href='#community']").parentNode;
      const communityMenu =
        '<li>' +
        '<a id="community-menu" href="#">Community <span style="font-size: 0.75em">&nbsp;▼</span></a>' +
        '<div id="community-dropdown" class="hide">' +
          '<ul id="community-dropdown-items">' +
            '<li><a href="/en/contact">Contact</a></li>' +
            '<li><a href="/en/contributing">Contributing</a></li>' +
            '<li><a href="/en/coding-guide">Coding guide</a></li>' +
            '<li><a href="/en/events">Events</a></li>' +
            '<li><a href="https://twitter.com/Apache_Pulsar" target="_blank">Twitter &#x2750</a></li>' +
            '<li><a href="https://github.com/apache/pulsar/wiki" target="_blank">Wiki &#x2750</a></li>' +
            '<li><a href="https://github.com/apache/pulsar/issues" target="_blank">Issue tracking &#x2750</a></li>' +
            '<li><a href="https://pulsar-summit.org/" target="_blank">Pulsar Summit &#x2750</a></li>' +
            '<li>&nbsp;</li>' +
            '<li><a href="/en/resources">Resources</a></li>' +
            '<li><a href="/en/team">Team</a></li>' +
            '<li><a href="/en/powered-by">Powered By</a></li>' +
          '</ul>' +
        '</div>' +
        '</li>';

      community.innerHTML = communityMenu;

      const communityMenuItem = document.getElementById("community-menu");
      const communityDropDown = document.getElementById("community-dropdown");
      communityMenuItem.addEventListener("click", function(event) {
        event.preventDefault();

        if (communityDropDown.className == 'hide') {
          communityDropDown.className = 'visible';
        } else {
          communityDropDown.className = 'hide';
        }
      });
    </script></span></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'd226a455cecdd4bc18a554c1b47e5b52',
                indexName: 'apache_pulsar',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["language:en","version:2.9.2"]}
              });
            </script></body></html>